var CopyLink=function(h,g){function j(a,c,e){if(a.addEventListener)a.addEventListener(c,e,false);else a.attachEvent&&a.attachEvent("on"+c,function(){return e.call(a,h.event)})}function l(){return h.getSelection?h.getSelection():g.selection&&g.selection.createRange?g.selection.createRange():false}function m(a){return a.toString?a.toString():a.text}function k(){var a=b.parentNode;a&&a.removeChild(b)}function i(a){this.minimalSelection=a.minimalSelection||20;this.container=a.container;this.handler=a.handler|| function(){return"<br>Source: "+location.href};this.create();this.setupEvents()}var b=null;i.addEvent=j;i.prototype={create:function(){if(!b){b=g.createElement("span");b.id="copylink";b.style.cssText="position: absolute; left: -9999px;"}},setupEvents:function(){var a=this;j(a.container,"copy",function(){a.insert()})},insert:function(){var a=l();if(a)if(!(m(a).length<this.minimalSelection))if(a.getRangeAt){var c=a.getRangeAt(0),e=g.createRange(),f=c.startContainer,d=c.endContainer;if(f&&d&&f.compareDocumentPosition){if(f.compareDocumentPosition(d)& 2){f=d;d=c.startContainer}f=c.endOffset;if(d.nodeType==1){d=d.lastChild;if(!d||d.nodeType!=3)return;f=d.data.length}e.setStart(d,f);b.innerHTML=this.handler();e.insertNode(b);c.setEndAfter(b);a.removeAllRanges();a.addRange(c);h.setTimeout(function(){c.setEndBefore(b);a.removeAllRanges();a.addRange(c);k()},0)}}else if(a.duplicate){e=a.duplicate();e.setEndPoint("StartToEnd",a);b.innerHTML=this.handler();e.pasteHTML(b.outerHTML);a.setEndPoint("EndToEnd",e);a.select();b=g.getElementById("copylink");h.setTimeout(k, 0)}}};return i}(window,document);